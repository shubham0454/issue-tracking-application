<div class="modal-backdrop show"></div>

<!-- Modal -->
<div class="modal show d-block" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content">
      
      <!-- Modal Header -->
      <div class="modal-header">
        <h5 class="modal-title">
          <i class="bi bi-bug"></i>
          {{isEditing ? 'Edit Issue' : 'Create New Issue'}}
        </h5>
        <button 
          type="button" 
          class="btn-close" 
          (click)="onClose()" 
          aria-label="Close">
        </button>
      </div>

      <!-- Form -->
      <form [formGroup]="form" (ngSubmit)="onSubmit()">
        
        <!-- Modal Body -->
        <div class="modal-body">
          
          <!-- Title Field -->
          <div class="mb-3">
            <label for="title" class="form-label">
              Title 
              <span class="text-danger">*</span>
            </label>
            <input 
              type="text" 
              class="form-control"
              [class.is-invalid]="isFieldInvalid('title')"
              id="title" 
              formControlName="title"
              placeholder="Enter issue title"
              maxlength="200">
            <div class="invalid-feedback" *ngIf="isFieldInvalid('title')">
              {{getFieldError('title')}}
            </div>
          </div>

          <!-- Description Field -->
          <div class="mb-3">
            <label for="description" class="form-label">
              Description 
              <span class="text-danger">*</span>
            </label>
            <textarea 
              class="form-control"
              [class.is-invalid]="isFieldInvalid('description')"
              id="description" 
              rows="4"
              formControlName="description"
              placeholder="Describe the issue in detail..."
              maxlength="2000">
            </textarea>
            <div class="invalid-feedback" *ngIf="isFieldInvalid('description')">
              {{getFieldError('description')}}
            </div>
          </div>

          <!-- Status and Priority Row -->
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="status" class="form-label">Status</label>
                <select class="form-select" id="status" formControlName="status">
                  <option *ngFor="let status of statusOptions" [value]="status">
                    {{status | titlecase}}
                  </option>
                </select>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-3">
                <label for="priority" class="form-label">Priority</label>
                <select class="form-select" id="priority" formControlName="priority">
                  <option *ngFor="let priority of priorityOptions" [value]="priority">
                    {{priority | titlecase}}
                  </option>
                </select>
              </div>
            </div>
          </div>

          <!-- Reporter and Assignee Row -->
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="reporter" class="form-label">
                  Reporter 
                  <span class="text-danger">*</span>
                </label>
                <input 
                  type="text" 
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('reporter')"
                  id="reporter" 
                  formControlName="reporter"
                  placeholder="Who reported this issue?"
                  maxlength="100">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('reporter')">
                  {{getFieldError('reporter')}}
                </div>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="mb-3">
                <label for="assignee" class="form-label">Assignee</label>
                <input 
                  type="text" 
                  class="form-control"
                  [class.is-invalid]="isFieldInvalid('assignee')"
                  id="assignee" 
                  formControlName="assignee"
                  placeholder="Who should work on this?"
                  maxlength="100">
                <div class="invalid-feedback" *ngIf="isFieldInvalid('assignee')">
                  {{getFieldError('assignee')}}
                </div>
              </div>
            </div>
          </div>

          <!-- Tags Field -->
          <div class="mb-3">
            <label for="tags" class="form-label">Tags</label>
            <input 
              type="text" 
              class="form-control" 
              id="tags" 
              formControlName="tags"
              placeholder="Enter tags separated by commas (e.g., bug, urgent, frontend)">
            <div class="form-text">
              Separate multiple tags with commas
            </div>
          </div>
        </div>

        <!-- Modal Footer -->
        <div class="modal-footer">
          <button 
            type="button" 
            class="btn btn-secondary" 
            (click)="onClose()" 
            [disabled]="loading">
            Cancel
          </button>
          
          <button 
            type="submit" 
            class="btn btn-primary" 
            [disabled]="loading || form.invalid">
            <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
            {{loading ? (isEditing ? 'Updating...' : 'Creating...') : (isEditing ? 'Update Issue' : 'Create Issue')}}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
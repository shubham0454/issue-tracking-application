<div class="container-fluid">
  <!-- Header -->
  <div class="row bg-dark text-white py-3">
    <div class="col">
      <div class="d-flex justify-content-between align-items-center">
        <h2>
          <i class="bi bi-bug"></i> 
          Issue Tracker
        </h2>
        <button class="btn btn-success" (click)="onCreateIssue()">
          <i class="bi bi-plus-lg"></i> 
          Create Issue
        </button>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="row bg-light py-3">
    <div class="col-md-3">
      <div class="input-group">
        <input 
          type="text" 
          class="form-control" 
          placeholder="Search issues..." 
          [(ngModel)]="searchTerm"
          (keyup.enter)="onSearch()">
        <button class="btn btn-outline-primary" (click)="onSearch()">
          <i class="bi bi-search"></i>
        </button>
      </div>
    </div>
    
    <div class="col-md-2">
      <select class="form-select" [(ngModel)]="statusFilter" (change)="onFilterChange()">
        <option value="">All Status</option>
        <option *ngFor="let status of statusOptions.slice(1)" [value]="status">
          {{status | titlecase}}
        </option>
      </select>
    </div>
    
    <div class="col-md-2">
      <select class="form-select" [(ngModel)]="priorityFilter" (change)="onFilterChange()">
        <option value="">All Priority</option>
        <option *ngFor="let priority of priorityOptions.slice(1)" [value]="priority">
          {{priority | titlecase}}
        </option>
      </select>
    </div>
    
    <div class="col-md-2">
      <input 
        type="text" 
        class="form-control" 
        placeholder="Filter by assignee" 
        [(ngModel)]="assigneeFilter"
        (keyup.enter)="onFilterChange()">
    </div>
    
    <div class="col-md-2">
      <select class="form-select" [(ngModel)]="pageSize" (change)="onFilterChange()">
        <option *ngFor="let size of pageSizeOptions" [value]="size">
          {{size}} per page
        </option>
      </select>
    </div>
  </div>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="text-center py-5">
    <div class="spinner-border" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <p class="mt-3">Loading issues...</p>
  </div>

  <!-- Issues Table -->
  <div *ngIf="!loading" class="row">
    <div class="col">
      <div class="table-responsive">
        <table class="table table-hover">
          <thead class="table-dark">
            <tr>
              <th scope="col" 
                  (click)="onSort('_id')" 
                  style="cursor: pointer;"
                  class="user-select-none">
                ID 
                <i [class]="'bi ' + getSortIcon('_id')"></i>
              </th>
              
              <th scope="col" 
                  (click)="onSort('title')" 
                  style="cursor: pointer;"
                  class="user-select-none">
                Title 
                <i [class]="'bi ' + getSortIcon('title')"></i>
              </th>
              
              <th scope="col" 
                  (click)="onSort('status')" 
                  style="cursor: pointer;"
                  class="user-select-none">
                Status 
                <i [class]="'bi ' + getSortIcon('status')"></i>
              </th>
              
              <th scope="col" 
                  (click)="onSort('priority')" 
                  style="cursor: pointer;"
                  class="user-select-none">
                Priority 
                <i [class]="'bi ' + getSortIcon('priority')"></i>
              </th>
              
              <th scope="col" 
                  (click)="onSort('assignee')" 
                  style="cursor: pointer;"
                  class="user-select-none">
                Assignee 
                <i [class]="'bi ' + getSortIcon('assignee')"></i>
              </th>
              
              <th scope="col" 
                  (click)="onSort('updatedAt')" 
                  style="cursor: pointer;"
                  class="user-select-none">
                Updated 
                <i [class]="'bi ' + getSortIcon('updatedAt')"></i>
              </th>
              
              <th scope="col">Actions</th>
            </tr>
          </thead>
          
          <tbody>
            <tr *ngFor="let issue of issues" 
                (click)="onRowClick(issue)" 
                class="cursor-pointer">
                
              <td>
                <code>{{issue._id.substring(0, 8)}}...</code>
              </td>
              
              <td>{{issue.title}}</td>
              
              <td>
                <span [class]="getStatusBadgeClass(issue.status)">
                  {{issue.status | titlecase}}
                </span>
              </td>
              
              <td>
                <span [class]="getPriorityBadgeClass(issue.priority)">
                  {{issue.priority | titlecase}}
                </span>
              </td>
              
              <td>{{issue.assignee || 'Unassigned'}}</td>
              
              <td>{{issue.updatedAt | date:'short'}}</td>
              
              <td>
                <button 
                  class="btn btn-sm btn-outline-primary" 
                  (click)="onEditIssue($event, issue)"
                  title="Edit Issue">
                  <i class="bi bi-pencil"></i>
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Empty State -->
      <div *ngIf="issues.length === 0" class="text-center py-5">
        <i class="bi bi-inbox display-1 text-muted"></i>
        <h4 class="text-muted mt-3">No issues found</h4>
        <p class="text-muted">Try adjusting your search or filters</p>
      </div>

      <!-- Pagination -->
      <div *ngIf="totalPages > 1" class="d-flex justify-content-between align-items-center mt-4">
        <div>
          Showing {{((currentPage - 1) * pageSize) + 1}} to {{Math.min(currentPage * pageSize, totalItems)}} 
          of {{totalItems}} issues
        </div>
        
        <nav aria-label="Issues pagination">
          <ul class="pagination">
            <li class="page-item" [class.disabled]="currentPage <= 1">
              <button class="page-link" 
                      (click)="onPageChange(currentPage - 1)" 
                      [disabled]="currentPage <= 1">
                Previous
              </button>
            </li>
            
            <li class="page-item" 
                [class.active]="currentPage === page" 
                *ngFor="let page of [].constructor(Math.min(totalPages, 5)); let i = index">
              <button class="page-link" (click)="onPageChange(i + 1)">
                {{i + 1}}
              </button>
            </li>
            
            <li class="page-item" [class.disabled]="currentPage >= totalPages">
              <button class="page-link" 
                      (click)="onPageChange(currentPage + 1)" 
                      [disabled]="currentPage >= totalPages">
                Next
              </button>
            </li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
</div>

<!-- Issue Form Modal -->
<app-issue-form 
  *ngIf="showCreateForm" 
  [issue]="editingIssue"
  (close)="onFormClose()">
</app-issue-form>
